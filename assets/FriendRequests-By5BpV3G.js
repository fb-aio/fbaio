import{aA as J,aH as ne,r as ie,aC as te,aJ as s,ba as se,b0 as W,b8 as ce,aL as y,b6 as U}from"./index-Cc323tmk.js";import{M as ae}from"./MyTable-Cq7Jx-ZU.js";import{k as j,p as F,b as re,d as R,t as oe,S as N,e as le,a as de,T as v,g as w}from"./MyApp-DaTURa7C.js";import{u as ue}from"./useAction-SccuV-f9.js";import{A as ge}from"./index-C_3N6Gag.js";import{I as me}from"./index-D3QWZW1f.js";import{R as he}from"./row-BSrRzCbj.js";import{T as fe}from"./index-I4RQw55H.js";import{R as V}from"./Table-GWHt3cPG.js";import{P as $}from"./index-DfJmVxJz.js";import"./index-BW-3Mymk.js";import"./index-BAOnGDsj.js";import"./PurePanel-Dk_aUIZi.js";import"./SearchOutlined-D7HYyH33.js";import"./index-DbOL86PG.js";import"./EyeOutlined-BH3kyVaw.js";import"./responsiveObserver-DA4txp13.js";import"./useBreakpoint-CeklF8Qr.js";import"./index-CCJcEIq_.js";import"./addEventListener-B_yQTNP2.js";import"./index-BAIy0Pdi.js";import"./index-BAiSCJnQ.js";import"./Dropdown-tWQs0LKH.js";import"./Pagination-yht7OtA3.js";var o=(i=>(i.INCOMING_REQUEST="INCOMING_REQUEST",i.OUTGOING_REQUEST="OUTGOING_REQUEST",i.DECLINED="DECLINED",i.ACCEPTED="ACCEPTED",i.CANCELED="CANCELED",i))(o||{});async function xe(i=""){const g=await j({fb_api_req_friendly_name:"FriendingCometFriendRequestsSectionPanelPaginationQuery",variables:{count:20,cursor:i,scale:2},doc_id:"4843321999100134"}),l=F(g);console.log(l);const{edges:d=[],page_info:u={}}=J(l);return d.map((e,O)=>{var m,p,h,T,_,C,q,E;return{id:(m=e==null?void 0:e.node)==null?void 0:m.id,name:(p=e==null?void 0:e.node)==null?void 0:p.name,avatar:(T=(h=e==null?void 0:e.node)==null?void 0:h.profile_picture)==null?void 0:T.uri,url:(_=e==null?void 0:e.node)==null?void 0:_.url,desc:(q=(C=e==null?void 0:e.node)==null?void 0:C.social_context)==null?void 0:q.text,seen:e==null?void 0:e.is_seen,time:((e==null?void 0:e.time)||0)*1e3,type:(E=e==null?void 0:e.node)==null?void 0:E.friendship_status,cursor:e==null?void 0:e.cursor}})}async function pe(i=""){const g=await j({fb_api_req_friendly_name:"FriendingCometOutgoingRequestsDialogPaginationQuery",variables:{count:10,cursor:i,scale:2},doc_id:"4420916318007844"}),l=F(g),{edges:d=[],page_info:u={}}=J(l);return d.map((e,O)=>{var m,p,h,T,_,C,q,E;return{id:(m=e==null?void 0:e.node)==null?void 0:m.id,name:(p=e==null?void 0:e.node)==null?void 0:p.name,avatar:(T=(h=e==null?void 0:e.node)==null?void 0:h.profile_picture)==null?void 0:T.uri,url:(_=e==null?void 0:e.node)==null?void 0:_.url,desc:(q=(C=e==null?void 0:e.node)==null?void 0:C.social_context)==null?void 0:q.text,seen:e==null?void 0:e.is_seen,time:((e==null?void 0:e.time)||0)*1e3,type:(E=e==null?void 0:e.node)==null?void 0:E.friendship_status,cursor:e==null?void 0:e.cursor}})}async function Te(i=""){var d,u,e;const g=await j({variables:{input:{friend_requester_id:i,source:"friends_tab",actor_id:"me"},scale:2,refresh_num:0},doc_id:"4189738374386264"}),l=F(g);return((e=(u=(d=l==null?void 0:l.data)==null?void 0:d.friend_request_delete)==null?void 0:u.friend_requester)==null?void 0:e.id)==i}async function _e(i=""){var d,u,e;const g=await j({variables:{input:{friend_requester_id:i,source:"friends_tab",actor_id:"me"},scale:2,refresh_num:0},doc_id:"3750307704981867"}),l=F(g);return((e=(u=(d=l==null?void 0:l.data)==null?void 0:d.friend_request_accept)==null?void 0:u.friend_requester)==null?void 0:e.id)==i}async function Ce(i=""){var d,u,e;const g=await j({fb_api_req_friendly_name:"FriendingCometFriendRequestCancelMutation",variables:{input:{attribution_id_v2:"FriendingCometFriendRequestsRoot.react,comet.friending.friendrequests,unexpected,1724509964587,135627,2356318349,,;FriendingCometRoot.react,comet.friending,tap_bookmark,1724509961317,200700,2356318349,,",cancelled_friend_requestee_id:i,friending_channel:"MANAGE_OUTGOING_REQUESTS",actor_id:"me"},scale:2},doc_id:"5247084515315799"}),l=F(g);return((e=(u=(d=l==null?void 0:l.data)==null?void 0:d.friend_request_cancel)==null?void 0:u.cancelled_friend_requestee)==null?void 0:e.id)==i}const I={[o.INCOMING_REQUEST]:{vi:"Đã nhận",en:"Incoming",color:"default",icon:"fa-solid fa-arrow-turn-down"},[o.OUTGOING_REQUEST]:{vi:"Đã gửi",en:"Outgoing",color:"default",icon:"fa-solid fa-arrow-turn-up"},[o.DECLINED]:{vi:"Đã từ chối",en:"Declined",color:"error",icon:"fa-solid fa-xmark"},[o.ACCEPTED]:{vi:"Đã chấp nhận",en:"Accepted",color:"success",icon:"fa-solid fa-check"},[o.CANCELED]:{vi:"Đã huỷ",en:"Canceled",color:"error",icon:"fa-solid fa-xmark"}};function He(){const{ti:i}=ne(),{message:g,notification:l}=re(),{onClickAction:d,onClickBulkActions:u}=ue(),[e,O]=R("FriendRequestType",o.INCOMING_REQUEST),[m,p]=R("FriendRequests.incoming",[]),[h,T]=R("FriendRequests.outgoing",[]),[_,C]=R("FriendRequests.finished",!1),[q,E]=R("FriendRequests.loading",!1);ie.useEffect(()=>{_||Q(!1)},[e,_]);const Q=async(t=!1)=>{const n="FriendRequests:onReload";oe(n);const r=[[o.INCOMING_REQUEST,xe,p,m],[o.OUTGOING_REQUEST,pe,T,h]].map(async([a,x,b,Y])=>{var H;const k=I[a],B=n+a;try{const f=t?[]:Y,S=f[f.length-1];let A=f.length,z=t?"":S==null?void 0:S.cursor;for(;;){g.loading({key:B,content:i({en:`Loading ${k.en} friend requests...`,vi:`Đang tải yêu cầu kết bạn ${k.vi}...`})+A,duration:0});const Z=await x(z),ee=new Set(f.map(G=>G.id)),D=Z.filter(G=>!ee.has(G.id));if(!(D!=null&&D.length))break;f.push(...D),b([...f]),A=f.length,z=(H=f[f.length-1])==null?void 0:H.cursor,await te(500)}g.success({key:B,content:i({en:"Loaded friend requests "+k.en+": ",vi:"Tải xong yêu cầu kết bạn "+k.vi+": "})+A})}catch(f){l.open({type:"error",message:i({en:"Failed to load friend requests "+k.en+": ",vi:"Lỗi tải yêu cầu kết bạn "+k.vi+": "}),description:f.message})}});E(!0),C(!1),await Promise.all(r),E(!1),C(!0)},L=t=>d({key:"FriendRequests:onClickDeclineFriendRequest",id:t.id,record:t,loadingText:n=>i({en:"Declining friend request...",vi:"Đang từ chối yêu cầu kết bạn..."})+" "+n.name,successText:n=>i({en:"Declined friend request ",vi:"Từ chối yêu cầu thành công "})+" "+n.name,failedText:n=>i({en:"Failed to decline friend request: ",vi:"Lỗi từ chối yêu cầu kết bạn: "})+" "+n.name,actionFn:()=>Te(t.id),onSuccess:()=>{p(n=>U(n,c=>{const r=c.findIndex(a=>a.id===t.id);return r>=0&&(c[r].type=o.DECLINED),c}))}}),M=t=>d({key:"FriendRequests:onClickAcceptFriendRequest",id:t.id,record:t,loadingText:n=>i({en:"Accepting friend request...",vi:"Đang đồng ý yêu cầu kết bạn..."})+" "+n.name,successText:n=>i({en:"Accepted friend request ",vi:"Đã đồng ý yêu cầu kết bạn "})+" "+n.name,failedText:n=>i({en:"Failed to accept friend request: ",vi:"Lỗi đồng ý yêu cầu kết bạn: "})+" "+n.name,actionFn:()=>_e(t.id),onSuccess:()=>{p(n=>U(n,c=>{const r=c.findIndex(a=>a.id===t.id);return r>=0&&(c[r].type=o.ACCEPTED),c}))}}),P=t=>d({key:"FriendRequests:onClickCancelOutgoingRequest",id:t.id,record:t,loadingText:n=>i({en:"Canceling friend request...",vi:"Đang thu hồi yêu cầu kết bạn..."})+" "+n.name,successText:n=>i({en:"canceled friend request ",vi:"Đã thu hồi yêu cầu kết bạn "})+" "+n.name,failedText:n=>i({en:"Failed to cancel friend request: ",vi:"Lỗi thu hồi yêu cầu kết bạn: "})+" "+n.name,actionFn:()=>Ce(t.id),onSuccess:()=>{T(n=>U(n,c=>{const r=c.findIndex(a=>a.id===t.id);return r>=0&&(c[r].type=o.CANCELED),c}))}}),X=t=>{const n=t!=null&&t.length?[...t]:[...e===o.INCOMING_REQUEST?m:h],c=n.filter(a=>a.type===o.INCOMING_REQUEST),r=n.filter(a=>a.type===o.OUTGOING_REQUEST);return s.jsxs(s.Fragment,{children:[s.jsx(y,{type:"primary",icon:s.jsx("i",{className:"fa-solid fa-rotate-right"}),loading:q,onClick:()=>Q(!0),children:i({en:"Reload",vi:"Tải lại"})}),e===o.INCOMING_REQUEST?s.jsxs(N.Compact,{children:[s.jsx(v,{title:i({en:`Accept ${c.length} selected incoming requests`,vi:`Đồng ý ${c.length} lời mời đang chọn`}),children:s.jsx($,{title:i({en:`Accept ${c.length} selected incoming requests`,vi:`Đồng ý ${c.length} lời mời đang chọn`}),description:i({en:`Are your sure want to accept ${c.length} incoming requests?`,vi:`Bản có chãc muốn đồng ý ${c.length} lời mời?`}),onConfirm:()=>u({data:c,key:"FriendRequests:onClickAcceptSelectedIncomingFriendRequests",actionFn:M,loadingText:(a,x,b)=>i({en:"Accepting incoming requests...",vi:"Đang đồng ý lời mời..."}),successText:(a,x)=>i({en:"Accepted incoming requests done: ",vi:"Đồng ý lời mời xong: "})+` ${a.length} / ${x.length}`,successDescItem:a=>s.jsx("a",{target:"_blank",href:w(a.id),children:a.name})}),okText:i({en:"Accept",vi:"Đồng ý"}),cancelText:i({en:"No",vi:"Huỷ"}),children:s.jsx(y,{disabled:c.length<=0,icon:s.jsx("i",{className:"fa-solid fa-check"}),children:c.length})})}),s.jsx(v,{title:i({en:`Decline ${c.length} selected incoming requests`,vi:`Từ chối ${c.length} lời mời đang chọn`}),children:s.jsx($,{title:i({en:`Decline ${c.length} selected incoming requests`,vi:`Từ chối ${c.length} lời mời đang chọn`}),description:i({en:`Are your sure want to decline ${c.length} incoming requests?`,vi:`Bản có chãc muốn từ chối ${c.length} lời mời?`}),onConfirm:()=>u({data:c,key:"FriendRequests:onClickDeclineSelectedIncomingFriendRequests",actionFn:L,loadingText:(a,x,b)=>i({en:"Declining incoming requests...",vi:"Đang từ chối lời mời..."}),successText:(a,x)=>i({en:"Declined incoming requests done: ",vi:"Từ chối lời mời xong: "})+` ${a.length} / ${x.length}`,successDescItem:a=>s.jsx("a",{target:"_blank",href:w(a.id),children:a.name})}),okText:i({en:"Decline",vi:"Từ chối"}),cancelText:i({en:"No",vi:"Huỷ"}),children:s.jsx(y,{danger:!0,disabled:c.length<=0,icon:s.jsx("i",{className:"fa-regular fa-trash-can"}),children:c.length})})})]}):s.jsx(s.Fragment,{children:s.jsx(v,{title:i({en:`Cancel ${r.length} selected outgoing requests`,vi:`Thu hồi ${r.length} yêu cầu đang chọn`}),children:s.jsx($,{title:i({en:`Cancel ${r.length} selected outgoing requests`,vi:`Thu hồi ${r.length} yêu cầu đang chọn`}),description:i({en:`Are your sure want to cancel ${r.length} outgoing requests?`,vi:`Bản có chãc muốn thu hồi ${r.length} yêu cầu?`}),onConfirm:()=>u({data:r,key:"FriendRequests:onClickCancelSelectedOutgoingFriendRequests",actionFn:P,loadingText:(a,x,b)=>i({en:"Canceling outgoing requests...",vi:"Đang thu hồi yêu cầu..."}),successText:(a,x)=>i({en:"Declined requests done: ",vi:"Thu hồi yêu cầu xong: "})+` ${a.length} / ${x.length}`,successDescItem:a=>s.jsx("a",{target:"_blank",href:w(a.id),children:a.name})}),okText:i({en:"Cancel",vi:"Thu hồi"}),cancelText:i({en:"No",vi:"Huỷ"}),children:s.jsx(y,{danger:!0,disabled:r.length<=0,icon:s.jsx("i",{className:"fa-regular fa-trash-can"}),children:r.length})})})}),s.jsx(v,{title:i({en:"View on Facebook",vi:"Xem trên Facebook"}),children:s.jsx(y,{icon:s.jsx("i",{className:"fa-solid fa-external-link"}),onClick:()=>window.open("https://www.facebook.com/friends/requests","_blank")})})]})},K=[{title:"#",key:"recent",dataIndex:"recent",render:(t,n,c)=>n.recent+1,sorter:(t,n)=>t.recent-n.recent,width:50},{title:i({en:"Name",vi:"Tên"}),key:"name",dataIndex:"name",sorter:(t,n)=>(t.name||"").localeCompare(n.name||""),render:(t,n,c)=>s.jsxs(N,{align:"center",style:{maxWidth:300},children:[s.jsx(ge,{shape:"square",src:s.jsx(me,{src:le(n.id),fallback:n.avatar}),size:50}),s.jsxs(N,{direction:"vertical",style:{marginLeft:"10px"},size:0,children:[s.jsx("a",{href:n.url,target:"_blank",children:s.jsx("b",{children:n.name})}),s.jsx("span",{style:{opacity:.5},children:n.id})]})]})},{title:i({en:"Description",vi:"Mô tả"}),key:"desc",dataIndex:"desc",sorter:(t,n)=>(t.desc||"").localeCompare(n.desc||""),render:(t,n,c)=>s.jsx("p",{style:{maxWidth:150,minWidth:100},children:n.desc}),width:"auto"},{title:i({en:"Time",vi:"Thời gian"}),key:"time",dataIndex:"time",sorter:(t,n)=>t.time-n.time,render:(t,n,c)=>n.time?s.jsxs(N,{direction:"vertical",children:[se(new Date(n.time)),s.jsx("span",{style:{opacity:.5},children:W(n.time)})]}):"-",onSearch:(t,n)=>ce(t,W(n)),width:180},{title:i({en:"Status",vi:"Trạng thái"}),key:"type",dataIndex:"type",filters:(e===o.INCOMING_REQUEST?[o.INCOMING_REQUEST,o.ACCEPTED,o.DECLINED]:[o.OUTGOING_REQUEST,o.CANCELED]).map(t=>{const n=I[t],c=[...m,...h].filter(r=>r.type===t).length;return{text:i(n)+` (${c})`,value:t}}),onFilter:(t,n)=>n.type===t,render:(t,n,c)=>{const r=I[n.type];return s.jsx(de,{color:r==null?void 0:r.color,children:i(r)})},align:"right"},{title:i({en:"Action",vi:"Hành động"}),key:"action",dataIndex:"action",render:(t,n,c)=>n.type===o.INCOMING_REQUEST?s.jsxs(N.Compact,{children:[s.jsx(v,{title:i({en:"Accept",vi:"Đồng ý"}),children:s.jsx(y,{onClick:()=>M(n),icon:s.jsx("i",{className:"fa-solid fa-check"})})}),s.jsx(v,{title:i({en:"Decline",vi:"Từ chối"}),children:s.jsx(y,{danger:!0,onClick:()=>L(n),icon:s.jsx("i",{className:"fa-solid fa-trash-can"})})})]}):n.type===o.OUTGOING_REQUEST?s.jsx(N.Compact,{children:s.jsx(v,{title:i({en:"Cancel",vi:"Thu hồi"}),children:s.jsx(y,{danger:!0,onClick:()=>P(n),icon:s.jsx("i",{className:"fa-solid fa-trash-can"})})})}):null,align:"right",width:100}];return s.jsxs("div",{style:{display:"flex",flexDirection:"column",width:"100%",height:"100%"},children:[s.jsx(he,{align:"middle",style:{margin:"16px"},children:s.jsx(fe.Title,{level:3,style:{margin:0},children:i({en:"Friend Requests",vi:"Lời mời kết bạn"})})}),s.jsx(V.Group,{defaultValue:e,buttonStyle:"solid",style:{marginBottom:10},children:[[o.INCOMING_REQUEST,m],[o.OUTGOING_REQUEST,h]].map(([t,n])=>{const c=n.length;return s.jsxs(V.Button,{value:t,onClick:()=>{O(t)},children:[s.jsx("i",{className:I[t].icon})," ",i(I[t])," ",c]},t)})}),s.jsx(ae,{data:(e===o.INCOMING_REQUEST?m:h).map((t,n)=>({...t,recent:n})),columns:K,renderTitle:X,size:"small",searchable:!0,selectable:!0,keyExtractor:t=>t.id})]})}export{He as default};
